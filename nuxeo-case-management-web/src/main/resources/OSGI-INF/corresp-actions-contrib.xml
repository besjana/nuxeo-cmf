<?xml version="1.0" encoding="UTF-8"?>
<component name="com.nuxeo.correspondence.actions">

  <require>org.nuxeo.ecm.platform.actions</require>
  <require>org.nuxeo.ecm.platform.notifications.web.actions</require>
  <require>org.nuxeo.ecm.platform.forum.actions</require>
  <require>org.nuxeo.ecm.platform.comment.actions</require>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

    <!-- remove useless -->
    <action id="newDocument" enabled="false" />
    <action id="newFile" enabled="false" />

    <action id="TAB_CONTENT">
      <filter-id>hideFromMailbox</filter-id>
    </action> 
    <action id="TAB_EDIT">
      <filter-id>hideFromMailbox</filter-id>
    </action> 
    <action id="TAB_MY_SUBSCRIPTIONS">
      <filter-id>hideFromMailbox</filter-id>
    </action>
    <action id="TAB_CONTENT_HISTORY">
      <filter-id>hideFromMailbox</filter-id>
    </action> 
    
   <!-- MailboxFolder Actions -->
    <action id="newMailbox"
      link="#{documentActions.createDocument('CorrespondenceMailbox')}"
      enabled="true" label="label.correspondence.createMailbox" icon="/icons/action_add.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>newCorrespondenceMailbox</filter-id>
    </action>

    <!-- Mailbox Management Actions -->
    <action id="editMailbox" link="/correspondence/mailbox/tabs/mailbox_edit.xhtml" order="20"
      label="label.correspondence.editMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_MAILBOX_ACTION_LIST</category>
    </action>

    <action id="TAB_MAILBOX_DELEGATION" link="/correspondence/mailbox/tabs/mailbox_delegation_content.xhtml" order="21"
      label="label.correspondence.delegationMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_MAILBOX_ACTION_LIST</category>
      
    </action>

    <action id="TAB_MAILBOX_NOTIFICATION" link="/incl/tabs/document_content.xhtml" order="22"
      label="label.correspondence.notificationMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_MAILBOX_ACTION_LIST</category>
      
    </action>

    <action id="TAB_MAILBOX_FAVORITES" link="/incl/tabs/document_content.xhtml" order="23"
      label="label.correspondence.favoritesMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_MAILBOX_ACTION_LIST</category>
      
    </action>

    <action id="TAB_MAILBOX_LISTES" link="/incl/tabs/document_content.xhtml" order="24"
      label="label.correspondence.listesMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_MAILBOX_ACTION_LIST</category>
      
    </action>

    <!-- Mailbox View Action -->
    <action id="TAB_MAILBOX_INBOX" link="/correspondence/mailbox/tabs/mailbox_inbox_content.xhtml" order="20"
      label="label.correspondence.inboxMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_MAILBOX_ACTION_LIST</category>
    </action>

    <action id="TAB_MAILBOX_SERVICE" link="/correspondence/mailbox/tabs/mailbox_service_content.xhtml" order="21"
      label="label.correspondence.serviceMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_MAILBOX_ACTION_LIST</category>
      <filter-id>isGenericMailbox</filter-id>
    </action>

    <action id="TAB_MAILBOX_SENT" link="/correspondence/mailbox/tabs/mailbox_sent_content.xhtml" order="22"
      label="label.correspondence.sentMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_MAILBOX_ACTION_LIST</category>
    </action>

    <action id="TAB_MAILBOX_DRAFT" link="/correspondence/mailbox/tabs/mailbox_draft_content.xhtml" order="23"
      label="label.correspondence.draftMailbox" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_MAILBOX_ACTION_LIST</category>
    </action>

    <!-- Mail Distribution actions -->

    <action id="initial_distribute_correspondence_envelope"
      link="distribution_correspondence_envelope"
      label="label.correspondence.action.initialDistributionRequest"
      order="10">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>isCorrespondenceInitialEnvelope</filter-id>
    </action>

    <action id="distribute_correspondence_envelope"
      link="distribution_correspondence_envelope"
      label="label.correspondence.action.distributionRequest"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>isNotCorrespondenceInitialEnvelope</filter-id>
    </action>

    <!-- End Mail Distribution actions -->

    <action id="TAB_DISTRIBUTION_RECIPIENTS"
      link="/correspondence/mail/tabs/distribute_correspondence_envelope.xhtml"
      label="label.correspondence.action.distributionRequest"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_ENVELOPE_ACTION_LIST</category>
      <filter-id>isCorrespondenceEnvelope</filter-id>
    </action>
    
    <action id="TAB_DISTRIBUTION_FAVORITES"
      link="/incl/tabs/document_content.xhtml"
      label="label.correspondence.action.distributionFavorites"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_ENVELOPE_ACTION_LIST</category>
      <filter-id>isCorrespondenceEnvelope</filter-id>
    </action>
    
    <action id="TAB_DISTRIBUTION_LISTS"
      link="/incl/tabs/document_content.xhtml"
      label="label.correspondence.action.distributionLists"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_ENVELOPE_ACTION_LIST</category>
      <filter-id>isCorrespondenceEnvelope</filter-id>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="newCorrespondenceMailbox">
      <rule grant="true">
        <permission>AddChildren</permission>
        <type>CorrespondenceMailboxRoot</type>
      </rule>
    </filter>

    <filter id="isCorrespondenceEnvelope">
      <rule grant="true">
        <facet>CorrespondenceEnvelope</facet>
      </rule>
    </filter>

    <filter id="isCorrespondenceInitialEnvelope">
      <rule grant="true">
        <facet>CorrespondenceEnvelope</facet>
        <condition>#{correspEnvelopeActions.isInitialEnvelope()}</condition>
      </rule>
    </filter>

    <filter id="isNotCorrespondenceInitialEnvelope">
      <rule grant="true">
        <facet>CorrespondenceEnvelope</facet>
      </rule>
      <rule grant="false">
        <condition>#{correspEnvelopeActions.isInitialEnvelope()}</condition>
      </rule>
    </filter>
    
    <filter id="isNotCorrespondenceEnvelope">
      <rule grant="false">
        <facet>CorrespondenceEnvelope</facet>
      </rule>
    </filter>

    <filter id="isCorrespondenceDocument">
      <rule grant="true">
        <facet>CorrespondenceDocument</facet>
      </rule>
    </filter>

    <filter id="isNotCorrespondenceDocument">
      <rule grant="false">
        <facet>CorrespondenceDocument</facet>
      </rule>
    </filter>

    <filter id="isCorrespondenceDocumentOrEnvelope">
      <rule grant="true">
        <facet>CorrespondenceDocument</facet>
        <facet>CorrespondenceEnvelope</facet>
      </rule>
    </filter>

    <filter id="isNotCorrespondenceDocumentOrEnvelope">
      <rule grant="false">
        <facet>CorrespondenceDocument</facet>
        <facet>CorrespondenceEnvelope</facet>
      </rule>
    </filter>

    <filter id="hideFromMailbox">
      <rule grant="false">
          <type>CorrespondenceMailbox</type>
        </rule>
    </filter>
    
    <filter id="is_correspondence_envelope">
      <rule grant="true">
        <facet>CorrespondenceEnvelope</facet>
      </rule>
    </filter>

    <filter id="isGenericMailbox">
      <rule grant="true">
        <condition>#{correspMailboxActions.isGenericMailbox()}</condition>
      </rule>
    </filter>

  </extension>

</component>
