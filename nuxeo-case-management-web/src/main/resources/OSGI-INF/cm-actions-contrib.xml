<?xml version="1.0" encoding="UTF-8"?>
<component name="com.nuxeo.correspondence.actions">

  <require>org.nuxeo.ecm.platform.actions</require>
  <require>org.nuxeo.ecm.platform.notifications.web.actions</require>
  <require>org.nuxeo.ecm.platform.forum.actions</require>
  <require>org.nuxeo.ecm.platform.comment.actions</require>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

    <!-- filter out some actions  -->

    <action id="TAB_MY_SUBSCRIPTIONS">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_MANAGE_SUBSCRIPTIONS">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_EDIT">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_METADATA_VIEW">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_METADATA_EDIT">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <!-- remove useless -->
    <action id="newDocument" enabled="false" />
    <action id="newFile" enabled="false" />

    <action id="TAB_CONTENT">
      <filter-id>hideFromCaseFolder</filter-id>
    </action> 
    <action id="TAB_EDIT">
      <filter-id>hideFromCaseFolder</filter-id>
    </action> 
    <action id="TAB_MY_SUBSCRIPTIONS">
      <filter-id>hideFromCaseFolder</filter-id>
    </action>
    <action id="TAB_CONTENT_HISTORY">
      <filter-id>hideFromCaseFolder</filter-id>
    </action> 
    
    <!-- case/case item tab actions -->
    <!-- redefine some tabs -->
    <action id="TAB_VIEW">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_CASE_MANAGEMENT_VIEW"
      link="/casemanagement/caseitem/tabs/document_properties.xhtml" order="10"
      label="label.casemanagement.tab.properties">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_DISTRIBUTION_HISTORY"
      link="/casemanagement/caseitem/tabs/document_distribution_history.xhtml"
      order="20" label="label.casemanagement.tab.distributionHistory">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_RELATIONS">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_CASE_MANAGEMENT_RELATIONS"
      link="/casemanagement/caseitem/tabs/document_relations.xhtml" order="30"
      label="label.casemanagement.tab.relations">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_FILES">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_FILES_EDIT">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_CASE_MANAGEMENT_FILES"
      link="/casemanagement/caseitem/tabs/document_files.xhtml" order="40"
      label="label.casemanagement.tab.files">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_CONTENT_HISTORY">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_CASE_MANAGEMENT_HISTORY"
      link="/casemanagement/caseitem/tabs/document_history.xhtml" order="50"
      label="label.casemanagement.tab.history">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
    </action>
    
    <action id="TAB_PREVIEW">
       <filter-id>isNotCaseItemOrCase</filter-id>
    </action>
    <action id="TAB_CASE_MANAGEMENT_PREVIEW" link="/casemanagement/caseitem/tabs/document_annotation_preview.xhtml"
      enabled="true" order="200" label="label.document.preview"
      icon="/icons/file.gif">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
      <filter-id>isCurrentCaseItemPreviewAvailable</filter-id>
    </action>
    
   <!-- CaseFolder Actions -->
    <action id="newCaseFolder"
      link="#{documentActions.createDocument('CaseFolder')}"
      enabled="true" label="label.casemanagement.createCaseFolder" icon="/icons/action_add.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>newCmCaseFolder</filter-id>
    </action>

    <action id="editMailbox" link="/casemanagement/casefolder/tabs/casefolder_edit.xhtml" order="20"
      label="label.casemanagement.editCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
    </action>

    <action id="TAB_CASE_FOLDER_DELEGATION" link="/casemanagement/casefolder/tabs/casefolder_delegation_content.xhtml" order="21"
      label="label.casemanagement.delegationCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
      
    </action>

    <action id="TAB_CASE_FOLDER_NOTIFICATION" link="/incl/tabs/document_content.xhtml" order="22"
      label="label.casemanagement.notificationCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
      
    </action>

    <action id="TAB_CASE_FOLDER_FAVORITES" link="/incl/tabs/document_content.xhtml" order="23"
      label="label.casemanagement.favoritesCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
      
    </action>

    <action id="TAB_CASE_FOLDER_LISTES" link="/incl/tabs/document_content.xhtml" order="24"
      label="label.casemanagement.listesCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
      
    </action>

    <!-- CaseFolder View Action -->
    <action id="TAB_CASE_FOLDER_INBOX" link="/casemanagement/casefolder/tabs/casefolder_inbox_content.xhtml" order="20"
      label="label.casemanagement.inboxCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_CASE_FOLDER_ACTION_LIST</category>
    </action>

    <action id="TAB_CASE_FOLDER_SERVICE" link="/casemanagement/casefolder/tabs/casefolder_service_content.xhtml" order="21"
      label="label.casemanagement.serviceCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_CASE_FOLDER_ACTION_LIST</category>
      <filter-id>isGenericCaseFolder</filter-id>
    </action>

    <action id="TAB_CASE_FOLDER_SENT" link="/casemanagement/casefolder/tabs/casefolder_sent_content.xhtml" order="22"
      label="label.casemanagement.sentCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_CASE_FOLDER_ACTION_LIST</category>
    </action>

    <action id="TAB_CASE_FOLDER_DRAFT" link="/casemanagement/casefolder/tabs/casefolder_draft_content.xhtml" order="23"
      label="label.casemanagement.draftCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>VIEW_CASE_FOLDER_ACTION_LIST</category>
    </action>

    <!-- Mail Distribution actions -->

    <action id="initial_distribute_correspondence_envelope"
      link="distribution_cm_case"
      label="label.casemanagement.action.initialDistributionRequest"
      order="10">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>isCmInitialCase</filter-id>
    </action>

    <action id="distribute_cm_case"
      link="distribution_cm_case"
      label="label.casemanagement.action.distributionRequest"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>isNotCmInitialCase</filter-id>
    </action>

    <!-- End Mail Distribution actions -->
    <!-- remove usual comment tab for correspondance documents -->
    <action id="view_comments">
      <filter-id>isNotCaseItemOrCase</filter-id>
    </action>

    <action id="TAB_CASE_MANAGEMENT_COMMENTS" link="/casemanagement/caseitem/tabs/document_comments.xhtml"
      enabled="true" order="80" label="action.view.comments">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCaseItemOrCase</filter-id>
      <filter-id>mutable_document</filter-id>
      <filter-id>not_anonymous</filter-id>
     </action>

    <action id="newComment" link="#{cmCommentActions.addComment}"
      enabled="true" label="command.add">
      <category>CASE_MANAGEMENT_COMMENT_ACTIONS</category>
    </action>

    <action id="cancelComment" link="#{commentManagerActions.cancelComment}"
      enabled="true" label="command.cancel">
      <category>CASE_MANAGEMENT_COMMENT_ACTIONS</category>
    </action>

    <!-- end of envelope/document tab actions -->
    
    <!-- Mailbox Management Actions -->
    <action id="TAB_CASE_FOLDER_PLANS" link="/casemanagement/casefolder/tabs/casefolder_plans_content.xhtml" order="25"
      label="label.casemanagement.plansCaseFolder" enabled="true"
      icon="/icons/file.gif">
      <category>MANAGE_CASE_FOLDER_ACTION_LIST</category>
      
    </action>
    <!-- End of Mailbox Management Actions -->

    <!-- Classification integration -->
    <action id="classification_request" link="classification_request"
      label="label.casemanagement.action.classificationRequest"
      icon="/icons/icone_classement.gif" order="30">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter-id>isNotCmInitialCase</filter-id>
    </action>

    <action id="newClassificationRoot">
      <filter id="newCaseFolderClassificationRoot">
        <rule grant="true">
          <type>CaseFolder</type>
        </rule>
      </filter>
    </action>
    <!-- end of Classification integration -->

    <action id="TAB_DISTRIBUTION_PARTICIPANTS"
      link="/casemanagement/caseitem/tabs/distribute_cm_case.xhtml"
      label="label.casemanagement.action.distributionRequest"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_CASE_ACTION_LIST</category>
      <filter-id>isCmCase</filter-id>
    </action>
    
    <action id="TAB_DISTRIBUTION_FAVORITES"
      link="/incl/tabs/document_content.xhtml"
      label="label.casemanagement.action.distributionFavorites"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_CASE_ACTION_LIST</category>
      <filter-id>isCmCase</filter-id>
    </action>
    
    <action id="TAB_DISTRIBUTION_LISTS"
      link="/incl/tabs/document_content.xhtml"
      label="label.casemanagement.action.distributionLists"
      icon="/icons/correspondence_distribute.gif" order="10">
      <category>DISTRIBUTION_CASE_ACTION_LIST</category>
      <filter-id>isCmCase</filter-id>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="newCmCaseFolder">
      <rule grant="true">
        <permission>AddChildren</permission>
        <type>CaseFolderRoot</type>
      </rule>
    </filter>

    <filter id="isCmCase">
      <rule grant="true">
        <facet>Case</facet>
      </rule>
    </filter>

    <filter id="isCmInitialCase">
      <rule grant="true">
        <facet>Case</facet>
        <condition>#{cmCaseActions.isInitialCase()}</condition>
      </rule>
    </filter>

    <filter id="isNotCmInitialCase">
      <rule grant="true">
        <facet>Case</facet>
      </rule>
      <rule grant="false">
        <condition>#{cmCaseActions.isInitialCase()}</condition>
      </rule>
    </filter>
    
    <filter id="isNotCmCase">
      <rule grant="false">
        <facet>Case</facet>
      </rule>
    </filter>

    <filter id="isCaseItem">
      <rule grant="true">
        <facet>CaseItem</facet>
      </rule>
    </filter>

    <filter id="isNotCaseItem">
      <rule grant="false">
        <facet>CaseItem</facet>
      </rule>
    </filter>

    <filter id="isCaseItemOrCase">
      <rule grant="true">
        <facet>CaseItem</facet>
        <facet>Case</facet>
      </rule>
    </filter>

    <filter id="isNotCaseItemOrCase">
      <rule grant="false">
        <facet>CaseItem</facet>
        <facet>Case</facet>
      </rule>
    </filter>

    <filter id="hideFromCaseFolder">
      <rule grant="false">
          <type>CaseFolder</type>
        </rule>
    </filter>
    
    <filter id="is_cm_casefolder">
      <rule grant="true">
        <facet>Case</facet>
      </rule>
    </filter>

    <filter id="isGenericCaseFolder">
      <rule grant="true">
        <condition>#{cmCaseFolderActions.isGenericCaseFolder()}</condition>
      </rule>
    </filter>

  </extension>

</component>
