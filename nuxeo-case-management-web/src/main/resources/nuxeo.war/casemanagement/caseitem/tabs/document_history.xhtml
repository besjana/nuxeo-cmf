<f:subview xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxh="http://nuxeo.org/nxweb/html">
  
  <style>
    pre.historyRecipient {
      font:normal 9px Verdana, Arial, sans-serif;
      white-space: pre-wrap;
      white-space: -moz-pre-wrap;
      white-space-pre-wrap;
      white-space-o-pre-wrap;
      word-wrap: break-word;
      _white-space: pre;
    }
  </style>

  <h3><h:outputText value="#{messages['label.casemanagement.distribution.history']}" /></h3>

  <h:dataTable var="logEntry" value="#{caseItemDistributionLogEntries}" class="dataOutput"
    rowClasses="dataRowEven,dataRowOdd">
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.performedAction']}" />
      </f:facet>
      <h:outputText value="#{messages[logEntry.eventId]}" />
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.date']} / #{messages['label.time']}" />
      </f:facet>
      <h:outputText value="#{logEntry.eventDate}">
        <f:convertDateTime pattern="#{nxu:basicDateAndTimeFormater()}"
          timeZone="#{timeZone}" />
      </h:outputText>
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.username']}" />
      </f:facet>
      <h:outputText value="#{nxu:userFullName(logEntry.principalName)}" />
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.comment']}" />
      </f:facet>
      <pre class="historyRecipient">
        <h:outputText value="#{messages[caseItemDistributionLogEntriesComments[logEntry.id]]}" />
      </pre>
      <f:subview rendered="#{(caseItemDistibutionEntriesLogLinkedDocs[logEntry.id])!=null}">
        <h:outputText value="   " />
        <nxu:graphicImage value="/icons/lock.gif"
          rendered="#{(distributionLogEntriesLinkedDocs[logEntry.id]).brokenDocument}"
          alt="#{(caseItemDistibutionEntriesLogLinkedDocs[logEntry.id]).documentRef}" />
        <nxd:restDocumentLink
          document="#{(caseItemDistibutionEntriesLogLinkedDocs[logEntry.id]).document}"
          rendered="#{!(caseItemDistibutionEntriesLogLinkedDocs[logEntry.id]).brokenDocument}">
          <nxu:graphicImage
            value="#{nxd:iconPath((caseItemDistibutionEntriesLogLinkedDocs[logEntry.id]).document)}"
            alt="#{(caseItemDistibutionEntriesLogLinkedDocs[logEntry.id]).document.type}">
          </nxu:graphicImage>
        </nxd:restDocumentLink>
      </f:subview>
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.casemanagement.distribution.history.actionParticipants']}" />
      </f:facet>
      <pre class="historyRecipient">
        <h:outputText value="#{logEntry.extendedInfos['eventContextRecipients_type_FOR_ACTION'].serializableValue}" />
      </pre>
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.casemanagement.distribution.history.copyParticipants']}" />
      </f:facet>
      <pre class="historyRecipient">
        <h:outputText value="#{logEntry.extendedInfos['eventContextRecipients_type_FOR_INFORMATION'].serializableValue}" />
      </pre>
    </h:column>
  </h:dataTable>
  
  <h3><h:outputText value="#{messages['title.history']}" /></h3>

  <h:dataTable var="logEntry" value="#{caseItemLogEntries}" class="dataOutput"
    rowClasses="dataRowEven,dataRowOdd"
    columnClasses="historyActionColumn, historyDateTimeColumn, historyAuthorColumn, historyCommentColumn">
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.performedAction']}" />
      </f:facet>
      <h:outputText value="#{messages[logEntry.eventId]}" />
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.date']} / #{messages['label.time']}" />
      </f:facet>
      <h:outputText value="#{logEntry.eventDate}">
        <f:convertDateTime pattern="#{nxu:basicDateAndTimeFormater()}"
          timeZone="#{timeZone}" />
      </h:outputText>
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.username']}" />
      </f:facet>
      <h:outputText value="#{nxu:userFullName(logEntry.principalName)}" />
    </h:column>
    <h:column>
      <f:facet name="header">
        <h:outputText value="#{messages['label.comment']}" />
      </f:facet>
      <p class="pre"
        style="white-space: pre-wrap; white-space: -moz-pre-wrap; white-space-pre-wrap; white-space-o-pre-wrap; word-wrap: break-word; _white-space: pre;">
      <h:outputText value="#{messages[caseItemLogEntriesComments[logEntry.id]]}"
        rendered="#{empty caseItemLogEntriesLinkedDocs[logEntry.id]}" /></p>
      <f:subview rendered="#{(caseItemLogEntriesLinkedDocs[logEntry.id])!=null}">
        <h:outputText value="   " />
        <nxu:graphicImage value="/icons/lock.gif"
          rendered="#{(caseItemLogEntriesLinkedDocs[logEntry.id]).brokenDocument}"
          alt="#{(caseItemLogEntriesLinkedDocs[logEntry.id]).documentRef}" />
        <nxd:restDocumentLink
          document="#{(caseItemLogEntriesLinkedDocs[logEntry.id]).document}"
          rendered="#{!(caseItemLogEntriesLinkedDocs[logEntry.id]).brokenDocument}">
          <nxu:graphicImage
            value="#{nxd:iconPath((caseItemLogEntriesLinkedDocs[logEntry.id]).document)}"
            alt="#{(caseItemLogEntriesLinkedDocs[logEntry.id]).document.type}">
          </nxu:graphicImage>
          <h:outputText value="#{nxd:titleOrId(caseItemLogEntriesLinkedDocs[logEntry.id].document)}" />
        </nxd:restDocumentLink>
      </f:subview>
    </h:column>
  </h:dataTable>

</f:subview>