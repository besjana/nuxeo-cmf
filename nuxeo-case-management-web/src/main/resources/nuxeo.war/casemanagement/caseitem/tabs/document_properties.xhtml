<div xmlns:h="http://java.sun.com/jsf/html" xmlns:c="http://java.sun.com/jstl/core"
  xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxl="http://nuxeo.org/nxforms/layout" xmlns:f="http://java.sun.com/jsf/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util">

  <h:form id="document_properties" enctype="multipart/form-data">
    <a4j:region id="documentViewRegion">
      <a4j:outputPanel id="documentViewPanel">
        <nxu:methodResult name="actions"
          value="#{webActions.getActionsList('CASE_ACTION_UPPER_LIST_HREF')}">
          <f:subview rendered="#{!empty actions}">
            <div class="action_bar nofloat">
              <nxu:dataList layout="unorderedList" var="action"
                value="#{actions}">
                <a href="#{action.getLink()}">
                  <h:graphicImage value="#{action.icon}" />
                  <h:outputText value="#{messages[action.label]}" />
                </a>
              </nxu:dataList>
            </div>
          </f:subview>
        </nxu:methodResult>
        <div style="clear:both;"></div>
        <nxl:documentLayout mode="#{cmDocumentActions.caseItemLayoutMode}"
          value="#{currentCaseItem}" />
        <div style="clear:both;"></div>
        <ui:include src="/incl/tagging.xhtml" />

      </a4j:outputPanel>
    </a4j:region>
    <c:if
      test="#{!cmDocumentActions.editingCaseItem and cmDocumentActions.canEditCurrentCaseItem}">
      <h:commandButton styleClass="button" immediate="true"
        value="#{messages['label.casemanagement.startEditing']}" action="#{cmDocumentActions.startEditingCaseItem()}" />
    </c:if>

    <c:if test="#{cmDocumentActions.editingCaseItem}">
      <table class="dataInput">
        <tbody>
          <tr>
            <td class="labelColumn">
              <h:outputText value="#{messages['label.comment']}" />
            </td>
            <td class="fieldColumn">
              <h:inputTextarea
                value="#{currentCaseItem.contextData['request/comment']}" />
            </td>
          </tr>
        </tbody>
      </table>
      <h:commandButton styleClass="button"
        value="#{messages['label.casemanagement.save']}" action="#{cmDocumentActions.save()}" />
      <h:commandButton styleClass="button"
        value="#{messages['command.cancel']}" action="#{cmDocumentActions.backToMailbox()}"
        immediate="true" />
    </c:if>

  </h:form>

</div>
